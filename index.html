<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PinkPetal.store</title>
<link rel="icon" href="" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

:root{
  --bg1:#2d0f18;
  --bg2:#6d2b3a;
  --pink-1:#ffbfdc;
  --pink-2:#ff8abf;
  --pink-3:#ff3ca6;
  --muted: rgba(255,214,234,0.12);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: 'Poppins', Arial, sans-serif;
  background: linear-gradient(180deg,var(--bg1),var(--bg2));
  color:#ffd6ea;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height:100vh;
}

/* container */
.container{ max-width:980px; margin:0 auto; padding:20px 16px 80px; }

/* topbar */
.topbar{ display:flex; justify-content:space-between; align-items:center; gap:18px; margin-bottom:22px; }
.brand{ font-weight:700; font-size:32px; color:var(--pink-2); text-shadow:0 6px 18px rgba(255,90,151,0.18); display:flex; align-items:center; gap:10px; }
.right-controls{ display:flex; align-items:center; gap:12px; }
.divider{ width:1px; height:44px; background:rgba(255,255,255,0.08); border-radius:6px; margin-left:6px; }

/* small controls */
.small-btn{ padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer; border:none; background:linear-gradient(90deg,var(--pink-2),var(--pink-3)); color:#fff; }
.small-btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:#ffd6ea; }

/* cart mini */
.cart-mini{ background:rgba(0,0,0,0.45); padding:8px 12px; border-radius:10px; display:flex; align-items:center; gap:8px; border:1px solid rgba(255,255,255,0.04) }

/* product grid */
.products{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:22px; margin-bottom:26px; }
.product{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:14px; text-align:center; border:1px solid rgba(255,255,255,0.03); box-shadow:0 12px 36px rgba(0,0,0,0.45); transition: transform .22s ease, box-shadow .22s ease; }
.product img{ width:100%; height:150px; object-fit:cover; border-radius:10px; margin-bottom:10px; }
.product h3{ margin:6px 0 4px; color:#ffd6ea; font-size:1.05rem; }
.product p{ margin:0 0 12px; color:#ffd6eacc; font-size:0.95rem; }
.product:hover{ transform:translateY(-6px); box-shadow:0 22px 48px rgba(0,0,0,0.55); }

/* buttons */
.btn{ padding:10px 14px; border-radius:10px; border:none; cursor:pointer; color:#fff; font-weight:800; background:linear-gradient(90deg,var(--pink-2),var(--pink-3)); box-shadow:0 10px 26px rgba(255,60,166,0.12); }
.btn.secondary{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:#ffd6ea; }
.btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:#ffd6ea; }

/* section titles */
.section-title{ text-align:center; font-size:22px; margin:22px 0 12px; color:var(--pink-1); font-weight:700; }

/* cart area */
.cart-bar-wrap{ display:flex; justify-content:center; margin-bottom:14px; }
.cart-bar{ width:420px; max-width:95%; background: rgba(0,0,0,0.45); border-radius:14px; padding:12px 16px; color:#ffd6ea; text-align:left; box-shadow:0 10px 30px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.03); }
#cart{ margin:0 auto 18px; width:92%; max-width:700px; background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.5)); padding:12px; border-radius:12px; color:#ffd6ea; box-shadow:0 10px 30px rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.03); }
#cart ul{ list-style:none; padding:0; margin:0; }
#cart li{ display:flex; gap:12px; align-items:center; justify-content:space-between; padding:10px 6px; border-bottom:1px dashed rgba(255,255,255,0.04); }
.item-left{ display:flex; gap:12px; align-items:center; flex:1; text-align:left; }
.item-left img{ width:56px; height:48px; object-fit:cover; border-radius:8px; }
.item-name{ font-weight:700; color:#ffd6ea; }
.item-price{ font-size:0.9rem; color:#ffd6eaaa; }

/* qty controls */
.qty-controls{ display:flex; align-items:center; gap:8px; }
.qty-btn{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:#fff; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:800; }
.qty-display{ font-weight:800; min-width:26px; text-align:center; color:#ffd6ea; }

/* line total */
.line-total{ min-width:84px; text-align:right; font-weight:700; color:#ffd6ea; }

/* grand total */
.cart-total{ margin-top:12px; text-align:right; font-weight:800; font-size:1.05rem; color:#ffd6ea; }

/* checkout */
.checkout-box{ max-width:460px; margin:16px auto 0; background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6)); padding:18px; border-radius:14px; box-shadow:0 16px 40px rgba(0,0,0,0.55); border:1px solid rgba(255,255,255,0.04); }
.checkout-box input{ width:100%; padding:12px 14px; margin:8px 0; border-radius:8px; border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); color:#ffd6ea; outline:none; }
.checkout-box input::placeholder{ color:#e6b9d0; }

/* login/register modal */
.account-overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.65)); z-index:9999; padding:20px; animation: fadeIn .18s ease; }
@keyframes fadeIn { from{opacity:0; transform:translateY(-6px)} to{opacity:1; transform:none} }
.account-card{ width:100%; max-width:520px; background: linear-gradient(180deg, rgba(10,6,8,0.85), rgba(0,0,0,0.55)); border-radius:14px; padding:18px; box-shadow:0 30px 60px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.03); position:relative; color:#ffd6ea; }
.account-close{ position:absolute; right:12px; top:12px; background:transparent; border:none; font-size:20px; color:#ffd6ea; cursor:pointer; opacity:0.95; }
/* contact section */
.contact-section{ margin-top:40px; max-width:900px; margin-left:auto; margin-right:auto; padding:28px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.35)); border:1px solid rgba(255,255,255,0.03); box-shadow:0 18px 40px rgba(0,0,0,0.5); color:#ffd6ea; }
.contact-grid{ display:grid; grid-template-columns: 1fr 340px; gap:20px; align-items:start; }
.contact-form input, .contact-form textarea{ padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02); color:#ffd6ea; outline:none; }

/* slide out account panel specifics (new) */
#accountPanel{ position:fixed; right:-480px; top:0; height:100vh; width:420px; max-width:94vw; z-index:9999; background: linear-gradient(180deg, rgba(12,6,8,0.98), rgba(0,0,0,0.85)); box-shadow:-30px 0 60px rgba(0,0,0,0.6); border-left:1px solid rgba(255,255,255,0.03); transition:right 320ms cubic-bezier(.2,.8,.2,1); overflow:auto; padding:22px 18px; color:#ffd6ea; border-top-left-radius:12px; border-bottom-left-radius:12px; }
#accountPanel.open{ right:0 !important; }
#accountPanelOverlay{ display:none; position:fixed; inset:0; z-index:9998; background:rgba(0,0,0,0.45); opacity:0; transition:opacity .18s ease; }
#accountPanelOverlay.show{ display:block; opacity:1; }

/* small responsive tweaks */
@media(max-width:880px){ .contact-grid{ grid-template-columns:1fr; } .topbar{ flex-direction:column; align-items:flex-start; gap:12px; } .divider{ display:none; } .brand{ font-size:28px; } }
@media(max-width:560px){ .product img{ height:130px; } .cart-bar{ width:95%; } .line-total{ min-width:64px; } #accountPanel{ width:94vw; } }
</style>
</head>
<body>

<div class="container">

  <!-- TOPBAR -->
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="brand">âœ¨ <span style="color:var(--pink-2)">PinkPetal.store</span> âœ¨</div>
    </div>

    <div style="display:flex;align-items:center;gap:16px;">
      <div class="divider" aria-hidden="true"></div>

      <div class="right-controls" role="region" aria-label="Account and cart controls">
        <button id="showLoginBtn" class="small-btn">Login / Sign up</button>
        <button id="showAccountBtn" class="small-btn ghost" style="display:none;">My Account</button>
        <button id="logoutBtn" class="small-btn ghost" style="display:none;">Logout</button>
        <div class="cart-mini" title="Cart items">
          <span>ðŸ›’</span><span id="cartCountMini">0</span>
        </div>
      </div>
    </div>
  </div>
  <!-- END TOPBAR -->

  <!-- LOGIN / REGISTER ACCOUNT MODAL -->
  <div id="accountModal" class="account-overlay" style="display:none;">
    <div class="account-card" role="dialog" aria-modal="true" aria-labelledby="accountTitle">
      <button id="closeAccountModal" class="account-close" aria-label="Close account panel">âœ•</button>
      <header style="margin-bottom:12px;">
        <h2 id="accountTitle" style="margin:0;font-size:20px;color:var(--pink-2)">Account</h2>
        <p style="margin:6px 0 0;color:#ffd6e0">Login or create an account to save addresses & orders</p>
      </header>

      <nav style="display:flex;gap:8px;margin:12px 0;">
        <button id="tabLogin" class="btn" style="padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.02)">Login</button>
        <button id="tabRegister" class="btn secondary" style="padding:8px 12px;border-radius:10px">Register</button>
      </nav>

      <main style="margin-top:6px;">
        <form id="loginForm" style="display:block;">
          <label style="display:block;margin-bottom:10px;"><input name="email" placeholder="Email" required style="width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);color:#ffd6ea"></label>
          <label style="display:block;margin-bottom:10px;"><input name="password" type="password" placeholder="Password" required style="width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);color:#ffd6ea"></label>
          <button class="btn" style="width:100%;padding:12px;border-radius:10px">Login</button>
        </form>

        <form id="registerForm" style="display:none;">
          <label style="display:block;margin-bottom:10px;"><input name="username" placeholder="Username" required style="width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);color:#ffd6ea"></label>
          <label style="display:block;margin-bottom:10px;"><input name="email" placeholder="Email" required style="width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);color:#ffd6ea"></label>
          <label style="display:block;margin-bottom:10px;"><input name="password" type="password" placeholder="Create password" required style="width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);color:#ffd6ea"></label>
          <button class="btn" style="width:100%;padding:12px;border-radius:10px">Create account</button>
        </form>
      </main>
      <footer style="margin-top:12px;font-size:13px;color:#ffd6e0">We store your info locally in your browser for this demo. For a production site add server-side auth and secure storage.</footer>
    </div>
  </div>
  <!-- END LOGIN / REGISTER -->

  <!-- NEW: PRODUCTS -->
  <div id="product-list" class="products" aria-live="polite"></div>

  <!-- CART -->
  <div class="section-title">ðŸ›’ Your Cart</div>
  <div class="cart-bar-wrap"><div class="cart-bar"><strong>Items in cart:</strong> <span id="cartCount">0</span></div></div>
  <div id="cart" aria-label="Cart contents"></div>

  <!-- CHECKOUT -->
  <div class="section-title">ðŸ“¦ Checkout</div>
  <div class="checkout-box">
    <form id="checkout-form">
      <input name="name" placeholder="Full Name" required>
      <input name="address" placeholder="Address" required>
      <input name="email" placeholder="Email" required>
      <input name="phone" placeholder="Phone (optional)">
      <button type="submit" class="btn" style="width:100%;">Continue to Payment</button>
    </form>
  </div>

  <!-- CONTACT SECTION -->
  <section class="contact-section" id="contactSection" aria-label="Contact us">
    <div class="contact-grid">
      <div>
        <h3 style="color:var(--pink-2);margin-top:0">Contact PinkPetal</h3>
        <p style="color:#ffd6e0">Have a question, custom order request, or feedback? Send us a message and we'll reply as soon as possible.</p>
        <div style="margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02)">
          <div style="font-weight:700">Email</div>
          <div style="margin-top:6px;color:#ffd6eacc">rbpun124@gmail.com</div>
        </div>
        <div style="margin-top:12px;color:#ffd6eacc;font-size:0.95rem">
          <strong>Business hours:</strong>
          <div style="margin-top:6px">Mon â€” Sat: 9:00 â€” 18:00</div>
        </div>
      </div>

      <div>
        <form id="contactFormBottom" class="contact-form" aria-label="Contact form">
          <input name="name" placeholder="Your name" required>
          <input name="email" type="email" placeholder="Your email" required>
          <input name="subject" placeholder="Subject" required>
          <textarea name="message" placeholder="Write your message here..." required></textarea>

          <div style="display:flex;gap:12px;align-items:center;margin-top:10px">
            <button type="submit" class="btn">Send message</button>
            <div id="contactStatusBottom" style="font-size:0.95rem;color:#ffd6e0;opacity:0.95;min-width:200px" role="status" aria-live="polite"></div>
          </div>
        </form>
      </div>
    </div>
  </section>

</div><!-- /container -->

<!-- subtle decorative dots -->
<div style="position:fixed;inset:0;pointer-events:none;background-image:radial-gradient(rgba(0,0,0,0.35) 1px, transparent 1px);background-size: 60px 60px;opacity:0.12"></div>

<!-- Account Slide-Out Panel & Overlay (REPLACES previous dashboard modal) -->
<div id="accountPanelOverlay"></div>

<aside id="accountPanel" aria-hidden="true">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;">
    <div style="display:flex;align-items:center;gap:10px;">
      <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,#ff8abf,#ff3ca6);display:flex;align-items:center;justify-content:center;font-weight:800;color:#25010a;font-size:18px;">
        <span id="accountAvatarInitials">PP</span>
      </div>
      <div>
        <div id="accountPanelTitle" style="font-weight:800;font-size:16px;color:var(--pink-2)">My Account</div>
        <div id="accountPanelSub" style="font-size:13px;opacity:0.9;color:#ffd6e0">Profile & saved info</div>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center;">
      <button id="accountPanelClose" aria-label="Close account panel" style="background:transparent;border:1px solid rgba(255,255,255,0.05);color:#ffd6ea;padding:8px 10px;border-radius:10px;cursor:pointer;">âœ•</button>
    </div>
  </div>

  <hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0 18px;">

  <section id="accountPanelContent" style="padding-bottom:24px;">
    <div id="profileSummary" style="margin-bottom:12px;"></div>

    <div style="margin-top:6px;">
      <h4 style="color:var(--pink-2);margin:0 0 8px;font-size:14px;">Saved Addresses</h4>
      <div id="addressList" style="margin-bottom:12px;"></div>
    </div>

    <form id="addAddressForm" style="margin-bottom:16px;">
      <input name="label" placeholder="Label (Home / Work)" required style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#ffd6ea;margin-bottom:8px;">
      <textarea name="address" placeholder="Full address" required style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#ffd6ea;margin-bottom:8px;min-height:84px;"></textarea>
      <input name="phone" placeholder="Phone" required style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#ffd6ea;margin-bottom:8px;">
      <button class="btn" style="width:100%;border-radius:10px;">Save address</button>
    </form>

    <div style="margin-top:6px;">
      <h4 style="color:var(--pink-2);margin:0 0 8px;font-size:14px;">My Orders</h4>
      <div id="ordersList" style="margin-bottom:12px;"></div>
    </div>
  </section>

  <div style="font-size:12px;color:#ffd6e0;opacity:0.95;margin-top:8px;">
    <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
      <div>Signed in as <span id="accountPanelEmail" style="font-weight:700"></span></div>
      <button id="accountSignOut" class="btn" style="padding:8px 10px;border-radius:8px;background:linear-gradient(90deg,#ff8abf,#ff3ca6);">Sign out</button>
    </div>
  </div>
</aside>

<!-- EmailJS library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>

<!-- MAIN JS: accounts, products, cart, contact -->
<script>
/* ---------------------------
   Account system (local demo)
---------------------------*/

// crypto for hashing passwords  
async function sha256hex(str){
  const data = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hash))
    .map(b => b.toString(16).padStart(2,'0'))
    .join('');
}

// storage helpers  
function loadUsers(){ return JSON.parse(localStorage.getItem('pp_users')||'[]'); }
function saveUsers(u){ localStorage.setItem('pp_users', JSON.stringify(u)); }
function getCurrentUser(){ return localStorage.getItem('pp_current_user'); }
function setCurrentUser(u){ localStorage.setItem('pp_current_user', u); }
function getUserObject(name){
  return loadUsers().find(u => u.username === name || u.email === name) || null;
}

// UI elements
const showLoginBtn = document.getElementById("showLoginBtn");
const showAccountBtn = document.getElementById("showAccountBtn");
const logoutBtn = document.getElementById("logoutBtn");
const accountModal = document.getElementById("accountModal");
const closeAccountModal = document.getElementById("closeAccountModal");
const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");
const tabLogin = document.getElementById("tabLogin");
const tabRegister = document.getElementById("tabRegister");

// Slide panel elements
const accountPanel = document.getElementById("accountPanel");
const accountOverlay = document.getElementById("accountPanelOverlay");
const accountPanelClose = document.getElementById("accountPanelClose");
const accountSignOut = document.getElementById("accountSignOut");
const accountAvatarInitials = document.getElementById("accountAvatarInitials");
const accountPanelEmail = document.getElementById("accountPanelEmail");

/* Refresh top-right buttons */
function refreshAccountUI(){
  const cur = getCurrentUser();
  if(cur){
    showLoginBtn.style.display = "none";
    logoutBtn.style.display = "";
    showAccountBtn.style.display = "";
  } else {
    showLoginBtn.style.display = "";
    logoutBtn.style.display = "none";
    showAccountBtn.style.display = "none";
  }
}

/* LOGIN MODAL */
showLoginBtn.onclick = () => { 
  setActiveTab("tabLogin");
  accountModal.style.display = "flex";
};
closeAccountModal.onclick = () => { accountModal.style.display = "none"; };
accountModal.addEventListener("click", e => {
  if(e.target === accountModal) accountModal.style.display = "none";
});

/* Switching login/register tabs */
function setActiveTab(tab){
  if(tab === "tabLogin"){
    loginForm.style.display = "block";
    registerForm.style.display = "none";
  } else {
    loginForm.style.display = "none";
    registerForm.style.display = "block";
  }
}
tabLogin.onclick = () => setActiveTab("tabLogin");
tabRegister.onclick = () => setActiveTab("tabRegister");

/* Register */
registerForm.onsubmit = async e => {
  e.preventDefault();
  const username = registerForm.username.value.trim();
  const email = registerForm.email.value.trim().toLowerCase();
  const pass = registerForm.password.value;

  if(!username || !email || !pass) return alert("Fill all fields!");

  let users = loadUsers();
  if(users.find(u => u.email === email || u.username === username)){
    return alert("User already exists");
  }

  const hash = await sha256hex(pass);
  users.push({ username, email, hash, addresses:[], orders:[] });
  saveUsers(users);
  setCurrentUser(username);

  accountModal.style.display = "none";
  refreshAccountUI();
  prefillCheckout();
  alert("Account created!");
};

/* Login */
loginForm.onsubmit = async e => {
  e.preventDefault();
  const email = loginForm.email.value.trim().toLowerCase();
  const pass = loginForm.password.value;

  let users = loadUsers();
  let u = users.find(u => u.email === email || u.username === email);
  if(!u) return alert("No user found");

  const hash = await sha256hex(pass);
  if(hash !== u.hash) return alert("Wrong password");

  setCurrentUser(u.username);
  accountModal.style.display = "none";
  refreshAccountUI();
  prefillCheckout();
  alert("Logged in!");
};

/* Logout */
logoutBtn.onclick = () => {
  localStorage.removeItem("pp_current_user");
  refreshAccountUI();
  alert("Logged out");
};

/* ---------------------------
   Slide-Out My Account Panel
---------------------------*/
function openAccountPanel(){
  accountPanel.classList.add("open");
  accountOverlay.classList.add("show");
  accountOverlay.style.display = "block";
  document.body.style.overflow = "hidden";
  setTimeout(()=> accountOverlay.style.opacity = "1", 10);
}
function closeAccountPanel(){
  accountPanel.classList.remove("open");
  accountOverlay.style.opacity = "0";
  setTimeout(()=>{
    accountOverlay.classList.remove("show");
    accountOverlay.style.display = "none";
  }, 200);
  document.body.style.overflow = "";
}

accountPanelClose.onclick = closeAccountPanel;
accountOverlay.onclick = closeAccountPanel;
accountSignOut.onclick = () => {
  localStorage.removeItem("pp_current_user");
  refreshAccountUI();
  closeAccountPanel();
  alert("Logged out");
};

/* Open My Account */
showAccountBtn.onclick = () => {
  const cur = getCurrentUser();
  if(!cur){
    setActiveTab("tabLogin");
    accountModal.style.display = "flex";
    return;
  }
  populateAccountPanel();
  openAccountPanel();
};

/* Fill account panel with data */
function populateAccountPanel(){
  const user = getUserObject(getCurrentUser());
  if(!user) return;

  accountAvatarInitials.textContent = (user.username || "?").slice(0,2).toUpperCase();
  accountPanelEmail.textContent = user.email;

  document.getElementById("profileSummary").innerHTML =
    `<div style='font-weight:800;font-size:16px'>${user.username}</div>
     <div style='opacity:.9;color:#ffd6e0'>${user.email}</div>`;

  /* addresses */
  let addrList = document.getElementById("addressList");
  addrList.innerHTML = "";
  if(user.addresses.length){
    user.addresses.forEach((a,idx)=>{
      addrList.innerHTML += `
      <div style="padding:10px;margin-bottom:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);border-radius:8px;">
        <strong>${a.label}</strong>
        <div style="margin-top:6px;">${a.address}</div>
        <div style="margin-top:6px;color:#ffd6eacc">Phone: ${a.phone}</div>
        <div style="margin-top:8px">
          <button class='btn' style='padding:6px 8px;margin-right:6px' onclick='useAddress(${idx})'>Use</button>
          <button class='btn' style='padding:6px 8px;background:#ff88b8' onclick='deleteAddress(${idx})'>Delete</button>
        </div>
      </div>`;
    });
  } else {
    addrList.innerHTML = `<div style='color:#ffd6eacc'>No addresses saved</div>`;
  }

  /* orders */
  let orders = user.orders.slice().reverse();
  let ordersBox = document.getElementById("ordersList");
  ordersBox.innerHTML = "";
  if(orders.length){
    orders.forEach(o=>{
      ordersBox.innerHTML += `
      <div style="padding:10px;margin-bottom:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);border-radius:8px;">
        <div style="font-weight:700">${o.id} â€¢ â‚¹${o.total}</div>
        <div style="margin-top:6px">${o.items.map(it=>it.name+" Ã—"+it.qty).join(", ")}</div>
        <div style="margin-top:6px;color:#ffd6eacc">${o.address}</div>
      </div>`;
    });
  } else {
    ordersBox.innerHTML = "<div style='color:#ffd6eacc'>No orders yet</div>";
  }
}

/* Add address */
document.getElementById("addAddressForm").onsubmit = e => {
  e.preventDefault();

  const user = getUserObject(getCurrentUser());
  const form = e.target;
  const label = form.label.value.trim();
  const address = form.address.value.trim();
  const phone = form.phone.value.trim();
  if(!label || !address || !phone) return alert("Fill all fields!");

  user.addresses.push({ label, address, phone });
  const users = loadUsers().map(u => u.username === user.username ? user : u);
  saveUsers(users);

  form.reset();
  populateAccountPanel();
  alert("Address saved");
};

/* Use address for checkout */
function useAddress(i){
  const user = getUserObject(getCurrentUser());
  const a = user.addresses[i];
  const checkout = document.getElementById("checkout-form");
  checkout.name.value = user.username;
  checkout.address.value = a.address;
  checkout.phone.value = a.phone;
  closeAccountPanel();
}

/* Delete address */
function deleteAddress(i){
  const user = getUserObject(getCurrentUser());
  user.addresses.splice(i,1);
  const users = loadUsers().map(u => u.username === user.username ? user : u);
  saveUsers(users);
  populateAccountPanel();
}

/* Fill checkout when logged in */
function prefillCheckout(){
  const user = getUserObject(getCurrentUser());
  if(!user) return;
  const form = document.getElementById("checkout-form");
  form.name.value = user.username;
  form.email.value = user.email;
  if(user.addresses.length) form.address.value = user.addresses[0].address;
}

/* expose accounts globally */
window.pp_accounts = { loadUsers, saveUsers, getUserObject, getCurrentUser };

/* ---------------------------
   PRODUCTS
---------------------------*/
let products = JSON.parse(localStorage.getItem("products")) || [];
if(products.length === 0){
  products = [
    {id:"p1", name:"Rosy Heart Trinket", price:299, img:"https://images.unsplash.com/photo-1545235617-9465b5a5f02f?q=80&w=800&auto=format&fit=crop"},
    {id:"p2", name:"Pink Macrame", price:499, img:"https://images.unsplash.com/photo-1519710164239-da123dc03ef4?q=80&w=800&auto=format&fit=crop"},
    {id:"p3", name:"Glitter Soap", price:199, img:"https://images.unsplash.com/photo-1585238342022-2c0e6b0a1d8b?q=80&w=800&auto=format&fit=crop"}
  ];
}
function renderProducts(){
  let box = document.getElementById("product-list");
  box.innerHTML = "";
  products.forEach((p,i)=>{
    box.innerHTML += `
    <article class="product">
      <img src="${p.img}">
      <h3>${p.name}</h3>
      <p>â‚¹${p.price}</p>
      <button class="btn" onclick="addToCart(${i})">Add to cart</button>
    </article>`;
  });
}
renderProducts();

/* ---------------------------
   CART
---------------------------*/
let cart = JSON.parse(localStorage.getItem("cart") || "[]");
function saveCart(){ localStorage.setItem("cart", JSON.stringify(cart)); renderCart(); }
function addToCart(i){
  let p = products[i];
  let item = cart.find(c => c.id === p.id);
  if(item) item.qty++;
  else cart.push({id:p.id, name:p.name, price:p.price, qty:1, img:p.img});
  saveCart();
}
function decreaseQty(i){
  if(cart[i].qty > 1) cart[i].qty--;
  else cart.splice(i,1);
  saveCart();
}
function increaseQty(i){ cart[i].qty++; saveCart(); }

function renderCart(){
  let area = document.getElementById("cart");
  area.innerHTML = "";
  if(cart.length === 0){
    area.innerHTML = "<div style='padding:12px;text-align:center;color:#ffd6eacc'>Your cart is empty</div>";
    document.getElementById("cartCount").textContent = 0;
    document.getElementById("cartCountMini").textContent = 0;
    return;
  }
  let html = "<ul>";
  let total = 0;
  cart.forEach((it,i)=>{
    let line = it.qty * it.price;
    total += line;
    html += `
    <li>
      <div class="item-left">
        <img src="${it.img}">
        <div>
          <div class="item-name">${it.name}</div>
          <div class="item-price">â‚¹${it.price} each</div>
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:12px;">
        <div class="qty-controls">
          <button class="qty-btn" onclick="decreaseQty(${i})">âˆ’</button>
          <div class="qty-display">${it.qty}</div>
          <button class="qty-btn" onclick="increaseQty(${i})">+</button>
        </div>
        <div class="line-total">â‚¹${line}</div>
      </div>
    </li>`;
  });

  html += "</ul>";
  html += `<div class="cart-total">Total: â‚¹${total}</div>`;
  area.innerHTML = html;

  document.getElementById("cartCount").textContent = cart.reduce((a,c)=>a+c.qty,0);
  document.getElementById("cartCountMini").textContent = cart.reduce((a,c)=>a+c.qty,0);
}
renderCart();

/* Checkout â†’ payment */
document.getElementById("checkout-form").onsubmit = e => {
  e.preventDefault();
  if(cart.length === 0) return alert("Cart empty!");

  let data = {
    name: e.target.name.value,
    email: e.target.email.value,
    address: e.target.address.value,
    phone: e.target.phone.value,
    cart: cart
  };
  localStorage.setItem("order", JSON.stringify(data));
  window.location.href = "payment.html";
};

/* ---------------------------
   Contact form (EmailJS)
---------------------------*/
const EMAILJS_SERVICE_ID = "service_npylb3d";
const EMAILJS_TEMPLATE_ID = "template_2z3qz9a";
const EMAILJS_PUBLIC_KEY  = "YwTWDK2zdlv0oqPSj";

emailjs.init(EMAILJS_PUBLIC_KEY);

document.getElementById("contactFormBottom").onsubmit = e => {
  e.preventDefault();
  let form = new FormData(e.target);

  let payload = {
    from_name : form.get("name"),
    from_email: form.get("email"),
    subject   : form.get("subject"),
    message   : form.get("message")
  };

  let status = document.getElementById("contactStatusBottom");
  status.textContent = "Sendingâ€¦";

  emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload)
    .then(()=>{
      status.textContent = "Message sent!";
      e.target.reset();
    })
    .catch(()=>{
      status.textContent = "Failed â€” try again later.";
    });
};

/* initialize UI */
refreshAccountUI();
prefillCheckout();
</script>

</body>
</html>

