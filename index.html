<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PinkPetal.store</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap');

:root{
  --bg1:#2d0f18;
  --bg2:#6d2b3a;
  --pink-1:#ffbfdc;
  --pink-2:#ff8abf;
  --pink-3:#ff3ca6;
  --card-bg: rgba(255,255,255,0.03);
}

/* Reset + base */
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: 'Poppins', Arial, sans-serif;
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  color: #ffd6ea;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height: 100vh;
}

/* container */
.container {
  max-width: 980px;
  margin: 0 auto;
  padding: 20px 16px 80px;
}

/* === TOP BAR (NEW) === */
.topbar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 22px;
  padding: 6px 10px;
  gap: 20px;
}

.brand {
  font-size: 32px;
  font-weight: 700;
  color: var(--pink-2);
  text-shadow: 0 6px 18px rgba(255,90,151,0.18);
  display:flex;
  align-items:center;
  gap:12px;
}

.divider {
  width: 1px;
  height: 44px;
  background: rgba(255,255,255,0.12);
  border-radius: 8px;
  margin-left: 18px;
}

/* right side controls */
.right-controls {
  display: flex;
  align-items: center;
  gap: 12px;
}

.small-btn {
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 10px;
}

/* mini cart bubble */
.cart-mini {
  background: rgba(0,0,0,0.45);
  padding: 8px 14px;
  border-radius: 10px;
  font-weight: 600;
  color: #ffd6ea;
  border: 1px solid rgba(255,255,255,0.05);
  display:flex;
  align-items:center;
  gap:8px;
}

/* products grid */
.products {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap:22px;
  margin-bottom: 26px;
}

.product {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding: 14px;
  border-radius: 14px;
  text-align:center;
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 12px 36px rgba(0,0,0,0.45);
  transition: transform .25s ease, box-shadow .25s ease;
}
.product:hover {
  transform: translateY(-6px);
  box-shadow: 0 22px 48px rgba(0,0,0,0.55);
}

.product img {
  width:100%;
  height:150px;
  object-fit:cover;
  border-radius:10px;
  margin-bottom:10px;
}

/* product text */
.product h3 { margin:6px 0 4px; color:#ffd6ea; font-size:1.05rem; }
.product p { margin:0 0 12px; color:#ffd6eacc; font-size:0.95rem; }

/* buttons */
.btn {
  display:inline-block;
  padding:10px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  color:#fff;
  font-weight:700;
  background: linear-gradient(90deg, var(--pink-2), var(--pink-3));
  box-shadow: 0 10px 26px rgba(255,60,166,0.12);
  transition: transform .15s ease, box-shadow .15s ease;
}
.btn.secondary {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.06);
  color: #ffd6ea;
}
.btn.tertiary {
  background: linear-gradient(90deg,#ff8abf,#ff629c);
}

/* cart section */
.section-title {
  text-align:center;
  font-size:22px;
  margin:22px 0 12px;
  color:var(--pink-1);
  font-weight:700;
}

.cart-bar-wrap {
  display:flex;
  justify-content:center;
  margin-bottom:14px;
}
.cart-bar {
  width:420px;
  max-width:95%;
  background: rgba(0,0,0,0.45);
  border-radius:14px;
  padding:12px 16px;
  color:#ffd6ea;
  text-align:left;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  border:1px solid rgba(255,255,255,0.03);
}

/* cart list (centered card) */
#cart {
  margin:0 auto 18px;
  width: 92%;
  max-width:700px;
  background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.5));
  padding:12px;
  border-radius:12px;
  color:#ffd6ea;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  border:1px solid rgba(255,255,255,0.03);
}

/* cart items */
#cart ul { list-style:none; padding:0; margin:0; }
#cart li {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  padding:10px 6px;
  border-bottom:1px dashed rgba(255,255,255,0.04);
}
.item-left { display:flex; gap:12px; align-items:center; flex:1; text-align:left; }
.item-left img { width:56px; height:48px; object-fit:cover; border-radius:8px; }
.item-name { font-weight:700; color:#ffd6ea; }
.item-price { font-size:0.9rem; color:#ffd6eaaa; }

/* qty controls */
.qty-controls {
  display:flex;
  align-items:center;
  gap:8px;
}
.qty-btn {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.06);
  color: #fff;
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}
.qty-display { font-weight:700; min-width:26px; text-align:center; color:#ffd6ea; }

/* line total */
.line-total { min-width:84px; text-align:right; font-weight:700; color:#ffd6ea; }

/* grand total */
.cart-total {
  margin-top:12px;
  text-align:right;
  font-weight:800;
  font-size:1.05rem;
  color:#ffd6ea;
}

/* checkout form */
.checkout-box {
  max-width:460px;
  margin:16px auto 0;
  background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6));
  padding:18px;
  border-radius:14px;
  box-shadow:0 16px 40px rgba(0,0,0,0.55);
  border:1px solid rgba(255,255,255,0.04);
}

.checkout-box input {
  width:100%;
  padding:12px 14px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.03);
  color:#ffd6ea;
  outline:none;
}

.checkout-box input::placeholder { color:#e6b9d0; }

/* ---------- Styled Account Modal (kept) ---------- */
.account-overlay{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.65));
  z-index:9999;
  padding:20px;
  animation: fadeIn .18s ease;
}
@keyframes fadeIn { from {opacity:0; transform: translateY(-6px)} to {opacity:1; transform:none} }

.account-card{
  width:100%; max-width:520px;
  background: linear-gradient(180deg, rgba(10,6,8,0.85), rgba(0,0,0,0.55));
  border-radius:14px;
  padding:18px;
  box-shadow: 0 30px 60px rgba(0,0,0,0.6);
  border: 1px solid rgba(255,255,255,0.03);
  position:relative;
  color:#ffd6ea;
}

/* close button */
.account-close{
  position:absolute; right:12px; top:12px;
  background:transparent; border:none; font-size:20px; color:#ffd6ea; cursor:pointer;
  opacity:0.95;
}
.account-close:hover{ transform:scale(1.08) }

/* header */
.account-header { text-align:left; margin-bottom:12px; }
.account-header h2 { margin:0; font-size:22px; color:var(--pink-2); }
.account-sub { margin:6px 0 0; font-size:0.9rem; opacity:0.9; color:#ffd6e0; }

/* tabs */
.account-tabs { display:flex; gap:8px; margin:12px 0; }
.tab {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.03);
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  color:#ffd6ea;
  font-weight:700;
  transition: all .15s ease;
}
.tab:hover { transform:translateY(-3px) }
.tab.is-active {
  background: linear-gradient(90deg, var(--pink-2), var(--pink-3));
  color:#fff;
  box-shadow:0 10px 26px rgba(255,60,166,0.12);
}

/* forms */
.account-body { margin-top:6px; }
.account-form { display:block; gap:8px; }
.field { display:block; margin-bottom:10px; }
.field input{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02);
  color:#ffd6ea;
  outline:none;
  font-size:1rem;
  transition: box-shadow .12s ease, transform .08s ease;
}
.field input::placeholder { color:#f2bcd8; opacity:0.9; }
.field input:focus{ box-shadow:0 8px 20px rgba(255,60,166,0.06); transform:translateY(-1px) }

/* account button */
.account-btn{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background: linear-gradient(90deg,var(--pink-2),var(--pink-3));
  color:#fff; font-weight:800;
  font-size:1rem;
  cursor:pointer;
  box-shadow:0 10px 28px rgba(255,60,166,0.12);
}
.account-btn:hover{ transform:translateY(-3px) }

/* footer */
.account-foot { margin-top:12px; font-size:0.85rem; opacity:0.9; color:#ffd6e0; text-align:center; }

/* ========== CONTACT SECTION STYLES ========== */
.contact-section {
  margin-top:40px;
  max-width:900px;
  margin-left:auto;
  margin-right:auto;
  padding:28px;
  border-radius:14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.35));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 18px 40px rgba(0,0,0,0.5);
  color:#ffd6ea;
}
.contact-grid { display:grid; grid-template-columns: 1fr 340px; gap:20px; align-items:start; }
.contact-info h3 { color:var(--pink-2); margin-top:0; }
.contact-form { display:flex; flex-direction:column; gap:10px; }
.contact-form input, .contact-form textarea {
  padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02); color:#ffd6ea; outline:none;
}
.contact-form textarea { min-height:140px; resize:vertical; }
.contact-note { font-size:0.95rem; color:#ffd6e0; opacity:0.9; }
.contact-actions { display:flex; gap:12px; align-items:center; margin-top:10px; }
.contact-status { font-size:0.95rem; color:#ffd6e0; opacity:0.95; min-width:200px; }

/* responsive */
@media(max-width:880px){
  .contact-grid { grid-template-columns:1fr; }
  .topbar { flex-direction:column; align-items:flex-start; gap:12px; }
  .divider { display:none; }
  .brand { font-size:28px; }
}
@media(max-width:560px){
  .product img { height:130px; }
  .header { font-size:28px; }
  .cart-bar { width: 95%; }
  .line-total { min-width:64px; }
}
</style>
</head>
<body>

<div class="container">

  <!-- NEW TOP BAR: brand on left, divider, controls on right -->
  <div class="topbar">
    <div style="display:flex; align-items:center; gap:12px;">
      <div class="brand">âœ¨ <span style="color:var(--pink-2)">PinkPetal.store</span> âœ¨</div>
    </div>

    <div style="display:flex; align-items:center; gap:16px;">
      <div class="divider" aria-hidden="true"></div>

      <div class="right-controls" role="region" aria-label="Account and cart controls">
        <button id="showLoginBtn" class="btn small-btn">Login / Sign up</button>
        <button id="showAccountBtn" class="btn small-btn" style="display:none;">My Account</button>
        <button id="logoutBtn" class="btn small-btn tertiary" style="display:none;">Logout</button>

        <div class="cart-mini" title="Cart items">
          <span style="font-size:16px;">ðŸ›’</span>
          <span id="cartCountMini">0</span>
        </div>
      </div>
    </div>
  </div>
  <!-- END TOP BAR -->

  <!-- ACCOUNT MODAL -->
  <div id="accountModal" class="account-overlay" aria-hidden="true" style="display:none;">
    <div class="account-card" role="dialog" aria-modal="true" aria-labelledby="accountTitle">
      <button class="account-close" id="closeAccountModal" aria-label="Close account panel">âœ•</button>

      <header class="account-header">
        <h2 id="accountTitle">Account</h2>
        <p class="account-sub">Login or create an account to save addresses & orders</p>
      </header>

      <nav class="account-tabs" role="tablist" aria-label="Account tabs">
        <button id="tabLogin" class="tab is-active" role="tab" aria-selected="true">Login</button>
        <button id="tabRegister" class="tab" role="tab" aria-selected="false">Register</button>
      </nav>

      <main class="account-body">
        <!-- login -->
        <form id="loginForm" class="account-form" style="display:block;">
          <label class="field">
            <input name="email" placeholder="Email" required autocomplete="username">
          </label>
          <label class="field">
            <input name="password" type="password" placeholder="Password" required autocomplete="current-password">
          </label>
          <button class="btn account-btn" type="submit">Login</button>
        </form>

        <!-- register -->
        <form id="registerForm" class="account-form" style="display:none;">
          <label class="field">
            <input name="username" placeholder="Username" required autocomplete="name">
          </label>
          <label class="field">
            <input name="email" placeholder="Email" required autocomplete="email">
          </label>
          <label class="field">
            <input name="password" type="password" placeholder="Create password" required autocomplete="new-password">
          </label>
          <button class="btn account-btn" type="submit">Create account</button>
        </form>
      </main>

      <footer class="account-foot">
        <small>We store your info locally in your browser for this demo. For real stores add a secure backend.</small>
      </footer>
    </div>
  </div>

  <!-- Account Dashboard Modal -->
  <div id="accountDashboard" class="modal-flex" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:9999;padding:20px;overflow:auto;">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="dashTitle" style="max-width:720px;max-height:90vh;overflow:auto;">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="dashTitle" style="margin:0">My Account</h3>
        <button id="closeAccountDash" style="background:transparent;border:none;color:#ffd6ea;font-size:18px;">âœ•</button>
      </div>

      <div style="margin-top:12px;">
        <h4>Profile</h4>
        <div id="profileSummary" style="margin-bottom:12px;"></div>

        <h4>Saved Addresses</h4>
        <div id="addressList" style="margin-bottom:12px;"></div>

        <form id="addAddressForm" style="margin-bottom:12px;">
          <input name="label" placeholder="Label (Home / Work)" required>
          <textarea name="address" placeholder="Full address" required style="width:100%;padding:8px;margin:6px 0;border-radius:6px;"></textarea>
          <input name="phone" placeholder="Phone" required>
          <button class="btn" style="width:100%;">Save address</button>
        </form>

        <h4>My Orders</h4>
        <div id="ordersList" style="margin-bottom:12px;"></div>
      </div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <div id="product-list" class="products" aria-live="polite"></div>

  <!-- CART -->
  <div class="section-title">ðŸ›’ Your Cart</div>
  <div class="cart-bar-wrap"><div class="cart-bar"><strong>Items in cart:</strong> <span id="cartCount">0</span></div></div>
  <div id="cart" aria-label="Cart contents"></div>

  <!-- CHECKOUT -->
  <div class="section-title">ðŸ“¦ Checkout</div>
  <div class="checkout-box">
    <form id="checkout-form">
      <input name="name" placeholder="Full Name" required>
      <input name="address" placeholder="Address" required>
      <input name="email" placeholder="Email" required>
      <input name="phone" placeholder="Phone (optional)">
      <button type="submit" class="btn" style="width:100%;">Continue to Payment</button>
    </form>
  </div>

  <!-- ========== CONTACT SECTION (Option C) ========== -->
  <section class="contact-section" id="contactSection" aria-label="Contact us">
    <div class="contact-grid">
      <div class="contact-info">
        <h3>Contact PinkPetal</h3>
        <p class="contact-note">Have a question, custom order request, or feedback? Send us a message and we'll reply as soon as possible.</p>

        <div style="margin-top:12px; padding:12px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.02)">
          <div style="font-weight:700">Email</div>
          <div style="margin-top:6px;color:#ffd6eacc">rbpun124@gmail.com</div>
        </div>

        <div style="margin-top:12px; color:#ffd6eacc; font-size:0.95rem">
          <strong>Business hours:</strong>
          <div style="margin-top:6px">Mon â€” Sat: 9:00 â€” 18:00</div>
        </div>
      </div>

      <div>
        <form id="contactFormBottom" class="contact-form" aria-label="Contact form">
          <input name="name" placeholder="Your name" required>
          <input name="email" type="email" placeholder="Your email" required>
          <input name="subject" placeholder="Subject" required>
          <textarea name="message" placeholder="Write your message here..." required></textarea>

          <div class="contact-actions">
            <button type="submit" class="btn">Send message</button>
            <div id="contactStatusBottom" class="contact-status" role="status" aria-live="polite"></div>
          </div>
        </form>
      </div>
    </div>
  </section>
  <!-- END CONTACT SECTION -->

</div>

<!-- subtle decorative dots -->
<div style="position:fixed;inset:0;pointer-events:none;background-image:radial-gradient(rgba(0,0,0,0.35) 1px, transparent 1px);background-size: 60px 60px;opacity:0.12"></div>

<!-- EmailJS library (optional) -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>

<!-- ACCOUNT JS -->
<script>
/* ---------- Simple client-side account system ----------
   Storage:
     pp_users -> array [{username,email,hash,addresses:[],orders:[]}]
     pp_current_user -> username (string)
   Note: Uses SHA-256 in-browser hashing. Not a replacement for server-side auth.
*/

// small helper: SHA-256 hex
async function sha256hex(str){
  const enc = new TextEncoder();
  const data = enc.encode(str);
  const hash = await crypto.subtle.digest('SHA-256', data);
  const bytes = new Uint8Array(hash);
  return Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('');
}

// storage helpers
function loadUsers(){ return JSON.parse(localStorage.getItem('pp_users')||'[]'); }
function saveUsers(users){ localStorage.setItem('pp_users', JSON.stringify(users)); }
function setCurrentUser(username){ localStorage.setItem('pp_current_user', username); }
function getCurrentUser(){ return localStorage.getItem('pp_current_user') || null; }
function getUserObject(username){
  const u = loadUsers().find(x => x.username === username || x.email === username);
  return u || null;
}

// UI elements
const showLoginBtn = document.getElementById('showLoginBtn');
const showAccountBtn = document.getElementById('showAccountBtn');
const logoutBtn = document.getElementById('logoutBtn');
const accountModal = document.getElementById('accountModal');
const accountDashboard = document.getElementById('accountDashboard');

const tabLogin = document.getElementById('tabLogin');
const tabRegister = document.getElementById('tabRegister');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const closeAccountModal = document.getElementById('closeAccountModal');
const closeAccountDash = document.getElementById('closeAccountDash');

// refresh UI based on login state
function refreshAccountUI(){
  const cur = getCurrentUser();
  if(cur){
    showLoginBtn.style.display = 'none';
    showAccountBtn.style.display = '';
    logoutBtn.style.display = '';
    showAccountBtn.textContent = 'My Account';
  } else {
    showLoginBtn.style.display = '';
    showAccountBtn.style.display = 'none';
    logoutBtn.style.display = 'none';
  }
}

// open account modal (ensure login tab active)
showLoginBtn.addEventListener('click', ()=>{ setActiveTab && setActiveTab('tabLogin'); accountModal.style.display='flex'; loginForm.style.display='block'; registerForm.style.display='none'; });
closeAccountModal.addEventListener('click', ()=>{ accountModal.style.display='none'; });

// close modal when clicking overlay (but not when clicking inside card)
accountModal.addEventListener('click', (ev) => {
  if(ev.target === accountModal) accountModal.style.display = 'none';
});

// tabs (also wired later by setActiveTab helper)
tabLogin.addEventListener('click', ()=>{ loginForm.style.display='block'; registerForm.style.display='none'; setActiveTab && setActiveTab('tabLogin'); });
tabRegister.addEventListener('click', ()=>{ loginForm.style.display='none'; registerForm.style.display='block'; setActiveTab && setActiveTab('tabRegister'); });

// register
registerForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const username = registerForm.username.value.trim();
  const email = registerForm.email.value.trim().toLowerCase();
  const password = registerForm.password.value;
  if(!username || !email || !password){ alert('Please fill all fields'); return; }

  let users = loadUsers();
  if(users.find(u=>u.email===email || u.username===username)){ alert('User/email already exists'); return; }
  const hash = await sha256hex(password);
  const newUser = { username, email, hash, addresses: [], orders: [] };
  users.push(newUser);
  saveUsers(users);
  setCurrentUser(username);
  accountModal.style.display='none';
  refreshAccountUI();
  alert('Account created and logged in as ' + username);
  prefillCheckout();
});

// login
loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = loginForm.email.value.trim().toLowerCase();
  const password = loginForm.password.value;
  if(!email || !password){ alert('Please fill all fields'); return; }
  const users = loadUsers();
  const user = users.find(u=>u.email===email || u.username===email);
  if(!user){ alert('No user found'); return; }
  const hash = await sha256hex(password);
  if(hash !== user.hash){ alert('Wrong password'); return; }
  setCurrentUser(user.username);
  accountModal.style.display='none';
  refreshAccountUI();
  alert('Logged in as ' + user.username);
  prefillCheckout();
});

// logout
logoutBtn.addEventListener('click', ()=>{
  localStorage.removeItem('pp_current_user');
  refreshAccountUI();
  alert('Logged out');
});

// open dashboard
showAccountBtn.addEventListener('click', ()=>{
  populateAccountDashboard();
  accountDashboard.style.display='flex';
});
closeAccountDash.addEventListener('click', ()=>{ accountDashboard.style.display = 'none'; });

// populate account dashboard
function populateAccountDashboard(){
  const cur = getCurrentUser();
  if(!cur) { alert('Not logged in'); return; }
  const user = getUserObject(cur);
  document.getElementById('profileSummary').innerHTML = `<div><strong>${user.username}</strong> â€¢ ${user.email}</div>`;
  // addresses
  const addrList = document.getElementById('addressList');
  addrList.innerHTML = '';
  if(user.addresses && user.addresses.length){
    user.addresses.forEach((a, idx)=>{
      const el = document.createElement('div');
      el.style.padding='8px';
      el.style.border='1px solid rgba(255,255,255,0.04)';
      el.style.marginBottom='8px';
      el.innerHTML = `<strong>${a.label}</strong><div style="font-size:0.95rem">${a.address}</div><div style="font-size:0.9rem;color:#ffd6eacc">Phone: ${a.phone}</div>
        <div style="margin-top:6px;"><button class="btn" style="padding:6px 10px;margin-right:8px;" onclick="useAddress(${idx})">Use</button>
        <button class="btn" style="padding:6px 10px;background:#ff88b8" onclick="deleteAddress(${idx})">Delete</button></div>`;
      addrList.appendChild(el);
    });
  } else {
    addrList.innerHTML = '<div style="color:#ffd6eacc">No addresses saved</div>';
  }

  // orders
  const orders = user.orders || [];
  const ol = document.getElementById('ordersList');
  ol.innerHTML = '';
  if(orders.length){
    orders.slice().reverse().forEach(o=>{
      const d = document.createElement('div');
      d.style.padding='8px'; d.style.border='1px solid rgba(255,255,255,0.04)'; d.style.marginBottom='8px';
      d.innerHTML = `<div style="font-weight:700">${o.id} â€¢ â‚¹${o.total}</div><div style="font-size:0.9rem">${o.name} â€¢ ${o.phone || ''}</div>
        <div style="margin-top:6px;font-size:0.9rem">${o.items.map(it=>it.name+' x'+it.qty).join(', ')}</div>`;
      ol.appendChild(d);
    });
  } else {
    ol.innerHTML = '<div style="color:#ffd6eacc">No orders yet</div>';
  }
}

// address form
document.getElementById('addAddressForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  const cur = getCurrentUser();
  if(!cur){ alert('Login first'); return; }
  const user = getUserObject(cur);
  const label = e.target.label.value.trim();
  const address = e.target.address.value.trim();
  const phone = e.target.phone.value.trim();
  if(!label||!address||!phone){ alert('Fill all fields'); return; }
  user.addresses = user.addresses || [];
  user.addresses.push({ label, address, phone });
  const users = loadUsers().map(u => u.username === user.username ? user : u);
  saveUsers(users);
  e.target.reset();
  populateAccountDashboard();
  alert('Address saved');
});

// use address to fill checkout
function useAddress(idx){
  const cur = getCurrentUser();
  if(!cur){ alert('Login first'); return; }
  const user = getUserObject(cur);
  const a = user.addresses[idx];
  const nameField = document.querySelector('form#checkout-form input[name="name"]');
  const addressField = document.querySelector('form#checkout-form input[name="address"]');
  const phoneField = document.querySelector('form#checkout-form input[name="phone"]');
  if(nameField) nameField.value = user.username || '';
  if(addressField) addressField.value = a.address || '';
  if(phoneField) phoneField.value = a.phone || '';
  accountDashboard.style.display='none';
  alert('Address filled in checkout form');
}

// delete address
function deleteAddress(idx){
  const cur = getCurrentUser();
  const user = getUserObject(cur);
  user.addresses.splice(idx,1);
  const users = loadUsers().map(u => u.username === user.username ? user : u);
  saveUsers(users);
  populateAccountDashboard();
}

// on successful order, attach to user orders (call this from order/payment success)
function attachOrderToUser(orderObj){
  const cur = getCurrentUser();
  if(!cur) return;
  const users = loadUsers();
  const user = users.find(u => u.username === cur);
  if(!user) return;
  user.orders = user.orders || [];
  user.orders.push(orderObj);
  saveUsers(users);
}

// prefill checkout if logged in
function prefillCheckout(){
  const cur = getCurrentUser();
  if(!cur) return;
  const user = getUserObject(cur);
  const nameField = document.querySelector('form#checkout-form input[name="name"]');
  const addressField = document.querySelector('form#checkout-form input[name="address"]');
  const emailField = document.querySelector('form#checkout-form input[name="email"]');
  if(nameField) nameField.value = user.username || '';
  if(emailField) emailField.value = user.email || '';
  if(user.addresses && user.addresses.length && addressField) addressField.value = user.addresses[0].address || '';
}

/* ---------------------------
   Small UX helper: tabs + focus
   --------------------------- */
function setActiveTab(tabId){
  const tabEls = document.querySelectorAll('.tab');
  tabEls.forEach(t => t.classList.remove('is-active'));
  const btn = document.getElementById(tabId);
  if(btn) btn.classList.add('is-active');

  if(tabId === 'tabLogin'){
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('registerForm').style.display = 'none';
    const f = document.querySelector('#loginForm input');
    if(f) f.focus();
  } else {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('registerForm').style.display = 'block';
    const f = document.querySelector('#registerForm input');
    if(f) f.focus();
  }
}

showLoginBtn.addEventListener('click', ()=>{ setActiveTab('tabLogin'); });

document.getElementById('tabLogin').addEventListener('click', ()=> setActiveTab('tabLogin'));
document.getElementById('tabRegister').addEventListener('click', ()=> setActiveTab('tabRegister'));

refreshAccountUI();
prefillCheckout();

// expose for other pages
window.pp_accounts = {
  loadUsers, saveUsers, getCurrentUser, getUserObject, attachOrderToUser
};
</script>

<!-- MAIN SITE JS (products, cart, checkout) -->
<script>
/* ========================
   PRODUCTS + DEMO SEED
   ======================== */
let products = JSON.parse(localStorage.getItem("products")) || [];

/* If there are no products in storage (first time), seed demo items. */
if(!products || products.length === 0) {
  products = [
    { id: "p1", name: "Rosy Heart Trinket", price: 299, img: "https://images.unsplash.com/photo-1545235617-9465b5a5f02f?q=80&w=800&auto=format&fit=crop" },
    { id: "p2", name: "Pink Macrame", price: 499, img: "https://images.unsplash.com/photo-1519710164239-da123dc03ef4?q=80&w=800&auto=format&fit=crop" },
    { id: "p3", name: "Glitter Soap", price: 199, img: "https://images.unsplash.com/photo-1585238342022-2c0e6b0a1d8b?q=80&w=800&auto=format&fit=crop" }
  ];
  // Not auto-saving here so admin can control products.
}

/* ------------------------
   Render products grid
   ------------------------ */
function renderProducts(){
  const grid = document.getElementById('product-list');
  grid.innerHTML = '';
  products.forEach((p, i) => {
    grid.innerHTML += `
      <article class="product" role="article">
        <img src="${p.img}" alt="${p.name}">
        <h3>${p.name}</h3>
        <p>â‚¹${Number(p.price)}</p>
        <button class="btn" onclick="addToCart(${i})" aria-label="Add ${p.name} to cart">Add to cart</button>
      </article>
    `;
  });
}
renderProducts();

/* =========================
   CART (with + and âˆ’)
   ========================= */
let cart = JSON.parse(localStorage.getItem('cart')) || [];

// Save cart helper
function saveCart(){
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

// Add product to cart (increments qty if exists)
function addToCart(index){
  const p = products[index];
  if(!p) return;
  const id = p.id || ('prod_' + Math.random().toString(36).slice(2,9));
  const price = Number(p.price) || 0;
  const existing = cart.find(it => it.id === id);
  if(existing){
    existing.qty = (existing.qty || 1) + 1;
  } else {
    cart.push({ id, name: p.name, price, qty: 1, img: p.img });
  }
  saveCart();
}

// increase qty
function increaseQty(i){
  if(!cart[i]) return;
  cart[i].qty = (cart[i].qty || 1) + 1;
  saveCart();
}

// decrease qty
function decreaseQty(i){
  if(!cart[i]) return;
  if(cart[i].qty > 1){
    cart[i].qty--;
  } else {
    cart.splice(i,1);
  }
  saveCart();
}

// render cart content
function renderCart(){
  const container = document.getElementById('cart');
  container.innerHTML = '';
  if(!cart || cart.length === 0){
    container.innerHTML = '<div style="padding:12px;text-align:center;color:#ffd6eacc">Your cart is empty</div>';
    document.getElementById('cartCount').textContent = 0;
    document.getElementById('cartCountMini').textContent = 0;
    return;
  }
  let html = '<ul>';
  cart.forEach((it, i) => {
    const lineTotal = Number(it.price) * Number(it.qty);
    html += `
      <li>
        <div class="item-left">
          <img src="${it.img}" alt="${it.name}">
          <div>
            <div class="item-name">${it.name}</div>
            <div class="item-price">â‚¹${it.price} each</div>
          </div>
        </div>

        <div style="display:flex;align-items:center;gap:12px;">
          <div class="qty-controls" role="group" aria-label="Quantity controls">
            <button class="qty-btn" onclick="decreaseQty(${i})" aria-label="Decrease quantity">âˆ’</button>
            <div class="qty-display">${it.qty}</div>
            <button class="qty-btn" onclick="increaseQty(${i})" aria-label="Increase quantity">+</button>
          </div>

          <div class="line-total">â‚¹${lineTotal}</div>
        </div>
      </li>
    `;
  });
  html += '</ul>';

  const total = cart.reduce((s, it) => s + (Number(it.price) * Number(it.qty)), 0);
  html += `<div class="cart-total">Total: â‚¹${total}</div>`;

  container.innerHTML = html;
  document.getElementById('cartCount').textContent = cart.reduce((s, it) => s + it.qty, 0);
  document.getElementById('cartCountMini').textContent = cart.reduce((s, it) => s + it.qty, 0);
}

// initial render
renderCart();

/* --------------------------
   CHECKOUT: save order + go to payment
   -------------------------- */
document.getElementById('checkout-form').onsubmit = (e) => {
  e.preventDefault();
  if(cart.length === 0){
    alert('Your cart is empty');
    return;
  }
  const data = {
    name: e.target.name.value.trim(),
    address: e.target.address.value.trim(),
    email: e.target.email.value.trim(),
    phone: e.target.phone.value.trim(),
    cart: cart
  };
  localStorage.setItem('order', JSON.stringify(data));
  // redirect to payment page
  window.location.href = 'payment.html';
};
</script>

<!-- CONTACT FORM JS (bottom section) -->
<script>
/*
  Contact flow:
  - If EMAILJS_SERVICE_ID / TEMPLATE_ID / PUBLIC_KEY are filled (not placeholders),
    the form will send using EmailJS and deliver to rbpun124@gmail.com (pre-filled param).
  - Otherwise the message is stored locally in localStorage under 'pp_contacts' so you don't lose messages.
*/

const CONTACT_EMAIL = "rbpun124@gmail.com"; // your provided email

// ======= Inserted EmailJS credentials (from user) ========
const EMAILJS_SERVICE_ID = "service_npylb3d";    // your service id
const EMAILJS_TEMPLATE_ID = "template_2z3qz9a";  // your template id
const EMAILJS_PUBLIC_KEY  = "YwTWDK2zdlv0oqPSj";   // your public key
// ========================================================================================

const contactForm = document.getElementById('contactFormBottom');
const contactStatus = document.getElementById('contactStatusBottom');

// attempt to init EmailJS if PUBLIC_KEY is provided (not placeholder)
if(typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY){
  try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch(e){ console.warn('EmailJS init failed', e); }
}

function saveContactLocally(obj){
  const existing = JSON.parse(localStorage.getItem('pp_contacts') || '[]');
  existing.push(obj);
  localStorage.setItem('pp_contacts', JSON.stringify(existing));
}

function setStatus(text, ok){
  contactStatus.textContent = text;
  contactStatus.style.color = ok ? '#c8ffd6' : '#ffd6e0';
}

contactForm.addEventListener('submit', function(e){
  e.preventDefault();
  setStatus('Sendingâ€¦', true);

  const form = new FormData(contactForm);
  const payload = {
    from_name: form.get('name'),
    from_email: form.get('email'),
    subject: form.get('subject'),
    message: form.get('message'),
    to_email: CONTACT_EMAIL
  };

  // If EmailJS is configured (service+template+public set correctly), send via EmailJS
  const configured = EMAILJS_SERVICE_ID && EMAILJS_TEMPLATE_ID && EMAILJS_PUBLIC_KEY &&
                     !EMAILJS_SERVICE_ID.includes('YOUR_') && !EMAILJS_TEMPLATE_ID.includes('YOUR_') &&
                     !EMAILJS_PUBLIC_KEY.includes('YOUR_') && typeof emailjs !== 'undefined';

  if(configured){
    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload)
      .then(() => {
        setStatus('Message sent â€” thanks! â¤ï¸', true);
        contactForm.reset();
      })
      .catch(err => {
        console.error('EmailJS send error', err);
        setStatus('Send failed â€” message saved locally.', false);
        // fallback save locally
        saveContactLocally(Object.assign({created: new Date().toISOString(), via: 'local-fallback'}, payload));
      });
  } else {
    // Save locally until EmailJS is configured
    saveContactLocally(Object.assign({created: new Date().toISOString(), via: 'local'}, payload));
    setStatus('Message saved locally (EmailJS not configured).', true);
    contactForm.reset();
  }
});
</script>

</body>
</html>
